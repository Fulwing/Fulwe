<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
   <head>
      <!-- Required meta tags -->
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>User Settings | Fulwe</title>
      <!-- Favicon -->
      <link rel="icon" type="image/x-icon" th:href="@{/img/favicon.ico}">
      <!-- Bootstrap CSS -->
      <link rel="stylesheet" th:href="@{/plugins/bootstrap/css/bootstrap.min.css}">
      <!-- Linearicon Font -->
      <link rel="stylesheet" th:href="@{/plugins/linearicon/css/lnr-icon.css}">
      <!-- FontAwesome Free Font -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
      <!-- Custom CSS -->
      <link rel="stylesheet" th:href="@{/css/style.css}">

      <style>
         /* Discord background color */
         .bg-discord {
            background-color: #7289da; /* Discord's color */
         }

         /* Snapchat background color */
         .bg-snapchat {
            background-color: #ffea00; /* Dimmer Snapchat color */
         }
         /* Instagram background color */
         .bg-instagram {
            background-color: #e4405f; /* Instagram's color */
         }
         .bg-nothing{
            background-color: #000000;
         }

         .notification {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            left: 0;
            background-color: #4CAF50;
            color: white;
            padding: 16px;
            text-align: center;
            z-index: 1000;
         }

         .close-button {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            font-size: 20px;
            cursor: pointer;
         }

      </style>
      <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
      <!--[if lt IE 9]>
      <script src="assets/js/html5shiv.min.js"></script>
      <script src="assets/js/respond.min.js"></script>
      <![endif]-->
   </head>
   <body>
      <!-- Inner wrapper -->
      <div class="inner-wrapper">
         <!-- Header -->
         <header>
            <!-- Top Header Section -->
            <!-- /Top Header Section -->
            <!-- Main header Section -->
            <div class="main-header-section">
               <div class="container">
                  <div class="row align-items-center">
                     <div class="col-12">
                        <!-- Main Menu -->
                        <div class="main-menu menu-section w-100 d-inline-block d-md-block">
                                 <!-- offcanvas menu -->
                                 <!-- /offcanvas menu -->

                                 <!-- Navbar menu-->
                                 <nav th:replace="index/index::navbar" class="navbar navbar-expand-lg p-0">
                                 </nav>
                                 <!-- /Navbar menu-->
                              </div>
                        <!-- /Main Menu -->
                     </div>
                  </div>
               </div>
            </div>

            <!-- /Main Header Section -->
         </header>
         <!-- /Header -->
         <!-- Header Banner Section -->
         <section class="slider-wrapper py-5">
            <div class="container">
               <div class="row">
                  <div class="col-12 text-center">
                     <div class="inner-banner-heading py-0 py-md-3 py-lg-5">
                        <h1 class="text-white">User Settings</h1>
                     </div>
                  </div>
               </div>
            </div>
         </section>
         <!-- /Header Banner Section -->
         <!-- Bread crumb -->
         <div class="breadcrumb-wrapper bg-theme py-2">
               <div class="container">
                        <div class="row">
                           <div class="col-md-12">
                                 <div class="custom-breadcrumb">
                                    <ol class="breadcrumb no-bg-color p-0 m-0">
                                       <li class="breadcrumb-item d-inline-block"><a href="/" class="text-theme-secondary">Home</a></li>
                                       <li class="breadcrumb-item d-inline-block active">User Settings</li>
                                    </ol>
                                 </div>
                           </div>
                        </div>
               </div>   
               </div>    
         <!-- /Bread crumb -->   

         <!-- User settings -->
         <div class="checkout act-stgs py-5">
            <div class="container">
               <div class="row">
                  <div class="col-lg-4 col-md-12">
                     <aside class="sidebar sidebar-user">
                        <div class="user-card shadow border p-4">
                           <div class="user-info">
                              <div class="user-avatar text-center mb-4">
                                 <img th:src="'data:image/jpeg;base64,' + ${session.profilepic}" alt="User Avatar" class="position-relative img-fluid rounded-circle" style="object-fit: cover; object-position: center center; width: 100px; height: 100px;">
                                 <a href="/dashboard/setting">
                                    <span class="badge badge-info bg-theme rounded-circle position-absolute p-2 ml-n3 border-white text-white"><i class="fa fa-cog display-6"></i></span>
                                 </a>
                              </div>
                              <div class="user-details text-center">
                                 <h4>[[${name}]]</h4>
                              </div>
                              <div class="my-wallet-blk text-center my-4">
                              <span class="border-theme radius-5 d-inline-block px-4 py-2 mt-0 mb-4 text-theme">
                                 My Wallet
                              </span>
                                 <div class="align-items-center">
                                    <span class="text-center "><i class="fa fa-usd"></i>&nbsp;[[${cus.getBalance()}]]</span>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="quicklink-sidebar-menu shadow border mt-4 p-4">
                           <div class="user-title-info">
                              <h4>Connect with me</h4>
                           </div>
                           <hr class="m-4">
                           <ul class="list-group border-0" th:if="${info != null}">
                              <li class="list-group-item border-0 p-0 mb-2" th:if="${info.getInstagram() != null}">
                                 <div class="bg-instagram px-3 py-1">
                                    <a class="text-white display-5" th:href="@{${info.getInstagram()}}">
                                       <i class="fab fa-instagram"></i>
                                       <h5 class="d-inline-block ml-5">Connect with me</h5>
                                    </a>
                                 </div>
                              </li>
                              <li class="list-group-item border-0 p-0 mb-2" th:if="${info.getDiscord() != null}">
                                 <div class="bg-discord px-3 py-1">
                                    <a class="text-white display-5" href="https://discord.com/">
                                       <i class="fab fa-discord"></i>
                                       <h5 class="d-inline-block ml-5" th:text="${info.getDiscord()}"></h5>
                                    </a>
                                 </div>
                              </li>
                              <li class="list-group-item border-0 p-0 mb-2" th:if="${info.getSnapchat() != null}">
                                 <div class="bg-snapchat px-3 py-1">
                                    <a class="text-white display-5" th:href="@{${info.getSnapchat()}}">
                                       <i class="fab fa-snapchat-ghost"></i>
                                       <h5 class="d-inline-block ml-5">Connect with me</h5>
                                    </a>
                                 </div>
                              </li>
                           </ul>

                           <div class="bg-nothing px-3 py-1" th:if="${info == null}">
                              <a class="text-white display-5" >
                                 <i class="fa fa-frown-o" aria-hidden="true"></i>
                                 <h5 class="d-inline-block ml-5">No Account Added</h5>
                              </a>
                           </div>
                        </div>
                     </aside>
                  </div>         
                  <div class="col-lg-8 col-md-12 mt-5 mt-md-5 mt-lg-0">
                     <div class="custom-border-left rounded shadow border p-4 bg-white mb-4 stg-title">
                        <div class="row align-items-center">
                           <div class="col-12">
                              <h3 class="text-capitalize">Account Settings</h3>
                           </div>
                        </div>
                     </div>
                     <div class="card shadow border mb-4">
                        <div class="card-header bg-white p-4">
                           <h4 class="card-title mb-0 text-capitalize coll-arrow cursor-pointer" data-toggle="collapse"
                               data-target="#personal-inf" aria-expanded="true">Personal Information</h4>
                        </div>
                        <div id="personal-inf" class="card-body p-4 collapse show">
                           <form method="post" th:action="@{/user/updateacc}" id="personal-info-form" enctype="multipart/form-data">
                              <div class="form-row mb-4">
                                 <p class="custom-label-style">Upload Profile Image</p>
                                 <div class="custom-file">
                                    <input type="file" class="custom-file-input" name="customFile" id="customFile" accept=".jpg, .jpeg, .webp, .png" onchange="displayFileName()">
                                    <label class="custom-file-label" for="customFile">Upload Image</label>
                                 </div>
                                 <div id="file-upload-message" class="mb-2" style="font-size: small;"></div>
                              </div>
                              <div class="form-row mb-4">
                                 <div class="col">
                                    <label>User Name</label>
                                    <input type="text" class="form-control bg-input" id="username" name="username" placeholder="Enter your username"
                                           th:value="${cus.getUsername()}">
                                 </div>
                              </div>
                              <div class="form-row mb-4">
                                 <div class="col">
                                    <label>Email</label>
                                    <input type="email" class="form-control bg-input" id="email" name="email" placeholder="Enter your email"
                                           th:value="${cus.getEmail()}">
                                 </div>
                              </div>
                              <div class="form-row mb-4">
                                 <div class="col-lg-6">
                                    <label for="new-password"> New Password </label>
                                    <input type="password" class="form-control bg-input mb-lg-0 mb-md-4 mb-4" id="new-password"
                                           placeholder="Enter your new password" name="new-password" oninput="checkPasswordStrength()">
                                    <div id="password-help" class="text-muted"></div>
                                 </div>
                                 <div class="col-lg-6">
                                    <label for="confirm-password">Confirm Password </label>
                                    <input type="password" class="form-control bg-input" id="confirm-password"
                                           placeholder="Re-enter your new password">
                                    <div id="password-match-error" class="text-danger"></div>
                                 </div>
                              </div>
                              <div class="form-row mb-4">
                                 <div class="col-lg-4">
                                    <label for="instagram">Instagram</label>
                                    <input type="text" class="form-control bg-input mb-lg-0 mb-md-4 mb-4"
                                           id="instagram" placeholder="Instagram URL" name="instagram" th:value="${info.getInstagram()}" th:if="${info.getInstagram() != null}">
                                    <input type="text" class="form-control bg-input" id="instagram-empty" name="instagram"
                                           placeholder="Instagram URL" th:if="${info.getInstagram() == null}">
                                 </div>
                                 <div class="col-lg-4">
                                    <label for="discord">Discord</label>
                                    <input type="text" class="form-control bg-input" id="discord"
                                           placeholder="Discord tag" th:value="${info.getDiscord()}" name="discord" th:if="${info.getDiscord() != null}">
                                    <input type="text" class="form-control bg-input" id="discord-empty"
                                           placeholder="Discord tag" name="discord" th:if="${info.getDiscord() == null}">
                                 </div>
                                 <div class="col-lg-4">
                                    <label for="snapchat">Snap Chat</label>
                                    <input type="text" class="form-control bg-input" id="snapchat"
                                           placeholder="Snap URL" th:value="${info.getSnapchat()}" name="snapchat" th:if="${info.getSnapchat() != null}">
                                    <input type="text" class="form-control bg-input" id="snapchat-empty"
                                           placeholder="Snap URL" name="snapchat" th:if="${info.getSnapchat() == null}">
                                 </div>
                              </div>
                              <div class="save-btn-blk mt-4 text-center">
                                 <button type="submit" class="btn btn-style radius-5 text-white d-block py-3 px-4 text-capitalize">Save Settings</button>
                              </div>
                           </form>
                        </div>
                     </div>
                     <div class="card shadow border mb-0">
                        <div class="card-header bg-white p-4">
                           <h4 class="card-title mb-0 text-capitalize coll-arrow cursor-pointer collapsed" data-toggle="collapse" data-target="#billing-inf" aria-expanded="true">Billing Information</h4>
                        </div>
                        <div id="billing-inf" class="card-body p-4 collapse">
                           <form>
                              <div class="form-row mb-4">
                                 <div class="col-lg-6">
                                    <label for="first-name">First Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control bg-input mb-lg-0 mb-md-4 mb-4" id="first-name" placeholder="Steve">
                                 </div>
                                 <div class="col-lg-6">
                                    <label for="last-name">Last Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control bg-input" id="last-name" placeholder="Bell">
                                 </div>
                              </div>
                              <div class="form-row mb-4">
                                 <div class="col">
                                    <label>Company Name</label>
                                    <input type="text" class="form-control bg-input" placeholder="SteveTech">
                                 </div>
                              </div>
                              <div class="form-row mb-4">
                                 <div class="col">
                                    <label>Email Address <span class="text-danger">*</span></label>
                                    <input type="email" class="form-control bg-input" placeholder="steve@nookx.com">
                                 </div>
                              </div>
                              <div class="form-row mb-4">
                                 <div class="col">
                                    <label class="col-form-label">Country <span class="text-danger">*</span></label>
                                    <select class="select bg-input">
                                       <option value="">Select your country</option>
                                       <option value="1">Country1</option>
                                       <option value="2">Country2</option>
                                    </select>
                                 </div>
                              </div>
                              <div class="form-row mb-4">
                                 <div class="col">
                                    <label>Address Line 1 </label>
                                    <input type="text" class="form-control bg-input" placeholder="Enter your address">
                                 </div>
                              </div>
                              <div class="form-row mb-4">
                                 <div class="col">
                                    <label>Address Line 2 </label>
                                    <input type="text" class="form-control bg-input" placeholder="Enter your address">
                                 </div>
                              </div>
                              <div class="form-row">
                                 <div class="col-lg-6">
                                    <label for="first-name">City / State <span class="text-danger">*</span></label>
                                    <select class="select bg-input mb-lg-0 mb-md-4 mb-4">
                                       <option value="">Select your city</option>
                                       <option value="1">City1</option>
                                       <option value="2">City2</option>
                                    </select>
                                 </div>
                                 <div class="col-lg-6">
                                    <label>Zip / Postal Code <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control bg-input" placeholder="Enter your zip code">
                                 </div>
                              </div>
                              <div class="save-btn-blk mt-4 text-center">
                                 <a href="javascript:;" class="btn btn-style radius-5 text-white d-block py-3 px-4  text-capitalize">Save Settings</a>
                              </div>                              
                           </form>
                        </div>
                     </div>                              
                  </div>         
               </div>
            </div>
         </div>
         <div id="notification" class="notification" th:if="${param.success}">
            <span id="notification-message" th:text="${param.success}"></span>
            <span class="close" onclick="closeNotification()">&times;</span>
         </div>
         <!-- /User Settings -->
         <!-- Footer -->
         <footer  th:replace="index/index::footer">
         </footer>
         <!-- /Footer -->
         </div>
      <!-- Inner Wrapper -->
      <!-- Optional JavaScript -->
      <script>
         function checkPasswordStrength() {
            var newPassword = document.getElementById("new-password").value;
            var passwordHelp = document.getElementById("password-help");

            // Define regex patterns for password strength
            var patterns = [
               /[A-Z]/,            // Uppercase letters
               /[a-z]/,            // Lowercase letters
               /\d/,               // Digits
               /[!@#$%^&*]/,       // Special characters
               /.{8,}/             // Minimum length of 8 characters
            ];

            var metRequirements = [false, false, false, false, false];

            // Check each pattern
            patterns.forEach(function (pattern, index) {
               if (pattern.test(newPassword)) {
                  metRequirements[index] = true;
               }
            });

            // Count the number of completed requirements
            var completedRequirements = metRequirements.filter(Boolean).length;

            // Construct a message to indicate what is missing
            var missingRequirements = [];

            if (!metRequirements[0]) {
               missingRequirements.push("uppercase letter");
            }

            if (!metRequirements[1]) {
               missingRequirements.push("lowercase letter");
            }

            if (!metRequirements[2]) {
               missingRequirements.push("digit");
            }

            if (!metRequirements[3]) {
               missingRequirements.push("special character");
            }

            if (!metRequirements[4]) {
               missingRequirements.push("8 characters");
            }

            // Update the visual feedback and text color
            if (completedRequirements === 5) {
               passwordHelp.innerHTML = "✔️ Password meets all requirements!";
               passwordHelp.style.color = "green";
            } else if (completedRequirements >= 4) {
               passwordHelp.innerHTML = "💦 Password is almost there! Add " + missingRequirements.join(", ") + ".";
               passwordHelp.style.color = "orange";
            } else if (completedRequirements >= 2) {
               passwordHelp.innerHTML = "🏃 Good start! Add " + missingRequirements.join(", ") + ".";
               passwordHelp.style.color = "orange";
            } else {
               passwordHelp.innerHTML = "❌ Incomplete. Add " + missingRequirements.join(", ") + ".";
               passwordHelp.style.color = "red";
            }
         }

         document.getElementById("personal-info-form").addEventListener("submit", function (event) {
            var newPassword = document.getElementById("new-password").value;
            var confirmPassword = document.getElementById("confirm-password").value;
            var passwordMatchError = document.getElementById("password-match-error");

            if (newPassword !== confirmPassword) {
               passwordMatchError.innerHTML = "Passwords do not match!";
               passwordMatchError.style.color = "red";
               event.preventDefault();
            } else {
               passwordMatchError.innerHTML = "";
            }
         });

         // Function to show the notification
         function showNotification(message) {
            var notification = document.getElementById("notification");
            var notificationMessage = document.getElementById("notification-message");

            if (message) {
               notificationMessage.textContent = message;
               notification.style.display = "block";
               setTimeout(function () {
                  notification.style.display = "none";
               }, 3000); // Hide after 3 seconds (adjust as needed)
            } else {
               notification.style.display = "none";
            }
         }

         function closeNotification() {
            var notification = document.getElementById("notification");
            notification.style.display = "none";
         }

         // Get the value of the success query parameter from the URL
         var urlParams = new URLSearchParams(window.location.search);
         var successMessage = urlParams.get("success");

         // Check if the successMessage is not empty
         if (successMessage) {
            showNotification(successMessage);
         }

      </script>

      <script>
         function displayFileName() {
            const fileInput = document.getElementById("customFile");
            const messageContainer = document.getElementById("file-upload-message");

            if (fileInput.files.length > 0) {
               const fileName = fileInput.files[0].name;
               const fileExtension = fileName.split('.').pop().toLowerCase(); // Get the file extension

               if (['jpg', 'jpeg', 'webp', 'png'].includes(fileExtension)) {
                  messageContainer.textContent = "You uploaded: " + fileName;
                  messageContainer.style.color = "blue"; // Set text color to blue
               } else {
                  messageContainer.textContent = "Please select a file with a .jpg, .jpeg, .webp, or .png extension.";
                  messageContainer.style.color = "red"; // Set text color to red
                  fileInput.value = ""; // Clear the file input (ignore the file)
               }
            } else {
               messageContainer.textContent = "";
            }
         }

         $("#personal-info-form").submit(function (event) {
            event.preventDefault();

            const fileInput = document.getElementById("customFile");
            const formData = new FormData();
            const file = fileInput.files[0];

            if (!file) {
               alert("Please select an image file.");
               return;
            }

            // Check if the selected file is an image (optional)
            if (!file.type.startsWith("image/")) {
               alert("Please select an image file.");
               return;
            }

            // Read the selected file as a Data URL (base64)
            const reader = new FileReader();
            reader.onload = function () {
               const base64Image = reader.result;
               formData.append("image", base64Image);

               // Perform AJAX POST request to send the base64 image to the backend
               $.ajax({
                  url: "/your-backend-endpoint", // Replace with your backend endpoint
                  type: "POST",
                  data: formData,
                  processData: false,
                  contentType: false,
                  success: function (response) {
                     // Handle the response from the backend
                     console.log("Image uploaded successfully:", response);
                  },
                  error: function (error) {
                     console.error("Error uploading image:", error);
                  }
               });
            };
            reader.readAsDataURL(file);
         });

      </script>
      <!-- jQuery -->
      <script th:src="@{/js/jquery.min.js}"></script>
      <!-- Bootstrap Core JS -->
      <script th:src="@{/js/popper.min.js}"></script>
      <script th:src="@{/plugins/bootstrap/js/bootstrap.min.js}"></script>
      <!-- Custom JS -->
      <script th:src="@{/js/script.js}"></script>
      <script th:src="@{/js/scriptlogin.js}"></script>
      <script src='https://kit.fontawesome.com/64d58efce2.js'></script>
   </body>
</html>